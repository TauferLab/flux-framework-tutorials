language: python
env:
  global:
  - TRAVIS=False
  - secure: Pz5/Q8RkDtQXelNgd8hKSlmA2n/4E9LvcSEUI98OyYuWERWYpfiSsMnxaYRGdLkdl0sJbnT/Z/+G5MdGnGw2SsHiXyyOG+xfXyTJm/+HCmbiTOoJzc1Av3g6lMMbS4A9ffFV6C36NB7akjuWj+G/kxWfY9X1C+Uqb7H6DtSI9FkVyS/ifQzj2jtO20d/SwtyCciPKIZyKFGCppjPTaQA0CozHq/vQFS1cLB62/mEigasj/qAQyExgDji49l3qvZeToWpcCUvMoUsgKvbzab3FLGya4IS6FcWJ4ChiBygjuB6GPfWGgWOF0rAlrZC3blREVgEQYJ4pLp+GqmHzCeysQ==
integrations:
  hub:
    - integrationName: docker_hub
      type: dockerRegistryLogin
  # notifications:
  #   - integrationName: A4MDSlackNotifications
  #     type: slack
  #     recipients:
  #       - "#lichens"
  #     on_success: always
  #     on_failure: always
  #     on_start: never
  #     on_pull_request: always
git:
  submodule: true
build:
  pre_ci_boot:
    image_name: tudo/a4md_base
    image_tag: latest
    pull: true
  ci:
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - mkdir build
    - cd build
    - cmake .. -DCMAKE_INSTALL_PREFIX=../_install
    - make install
    - cd ..
    - export PYTHONPATH=a4md/retrieve/test/
    - export PATH=_install/bin:$PATH
    - ./build/a4md/tests-main -r junit -o shippable/testresults/tests-main-report.xml
    - ./build/a4md/common/test/tests-cmn -r junit -o shippable/testresults/tests-cmn-report.xml
    - ./build/a4md/dtl/test/tests-dtl -r junit -o shippable/testresults/tests-dtl-report.xml
    - ./build/a4md/retrieve/test/tests-retrieve -r junit -o shippable/testresults/tests-retrieve-report.xml
    - ./build/a4md/ingest/test/tests-ingest -r junit -o shippable/testresults/tests-ingest-report.xml
    - echo "Build complete"
#  on_success:
#    - COVERALLS_REPO_TOKEN=$COVERALLS_REPO_TOKEN shippable_retry coveralls
